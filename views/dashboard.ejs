<%- include('partials/header', {
  title: 'Dashboard',
  profile,
  page: 'dashboard'
}) %>

<h1>Dashboard</h1>

<!-- WEEKLY TIMETABLE -->
<section class="card">
  <h2>Weekly Timetable</h2>

  <div class="table-scroll">
    <table class="grid">
      <thead>
        <tr>
          <th>Period</th>
          <% dayNames.forEach(function(day) { %>
            <th><%= day %></th>
          <% }) %>
        </tr>
      </thead>

      <tbody>
        <% gridRows.forEach(function(row, index) { %>
          <tr>
            <td><%= index + 1 %></td>
            <% row.forEach(function(cell) { %>
              <td><%= cell || '—' %></td>
            <% }) %>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</section>

<!-- ATTENDANCE RULES -->
<section class="card">
  <h2>Attendance Rules</h2>

  <% if (rules) { %>
    <p>
      Minimum <strong><%= rules.minimum_percentage %>%</strong><br>
      <span class="muted">
        <%= rules.semester_start %> – <%= rules.semester_end %>
      </span>
    </p>
  <% } else { %>
    <p class="muted">Rules not set.</p>
  <% } %>

</section>

<!-- SUBJECT-WISE ATTENDANCE -->
<section class="card">
  <h2>Subject-wise Attendance</h2>

  <% if (summary && summary.length) { %>
    <div class="table-scroll">
      <table class="grid">
        <thead>
          <tr>
            <th>Subject</th>
            <th>Total</th>
            <th>Attended</th>
            <th>Missed</th>
            <th>%</th>
            <th>Safe to miss</th>
          </tr>
        </thead>

        <tbody>
          <% summary.forEach(function(s) { %>
            <tr>
              <td><%= s.name %></td>
              <td><%= s.total %></td>
              <td><%= s.attended %></td>
              <td><%= s.missed %></td>
              <td><%= s.percentage %>%</td>
              <td><%= s.safeToMiss %> hrs</td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } else { %>
    <p class="muted">
      Set timetable and mark attendance to see summary.
    </p>
  <% } %>
</section>

<!-- EXAM DAYS -->
<section class="card">
  <h2>Exam Days</h2>

  <% if (examDates && examDates.length) { %>
    <ul class="exam-list">
      <% examDates.forEach(function(date) { %>
        <li class="exam-day"><%= date %></li>
      <% }) %>
    </ul>
  <% } else { %>
    <p class="muted">
      Mark a class as <strong>Exam</strong> in Mark Attendance to list exam days here.
    </p>
  <% } %>
</section>

<%- include('partials/footer') %>
