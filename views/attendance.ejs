<%- include('partials/header', { title: 'Mark Attendance' , profile, page: 'attendance' }) %>

  <h1>Mark Attendance</h1>

  <!-- ===================== SINGLE ENTRY ===================== -->
  <section class="card">
    <h2>Mark Single Class</h2>

    <form method="post" action="/attendance" class="form form-inline">

      <div class="field">
        <label for="date">Date</label>
        <input type="date" id="date" name="date" required>
      </div>

      <div class="field">
        <label for="subject_id">Subject</label>
        <select id="subject_id" name="subject_id" required>
          <option value="">— Select —</option>
          <% if (subjects && subjects.length) { %>
            <% subjects.forEach(function(s) { %>
              <option value="<%= s.id %>">
                <%= s.name %>
              </option>
              <% }) %>
                <% } %>
        </select>
      </div>

      <div class="field">
        <label for="status">Status</label>
        <select id="status" name="status" required>
          <option value="attended">Attended</option>
          <option value="missed">Missed</option>
          <option value="holiday">College Holiday</option>
          <option value="exam">Exam</option>
        </select>
      </div>

      <button type="submit" class="btn">Save</button>
    </form>
  </section>



  <!-- ===================== RECENT ENTRIES ===================== -->
  <section class="card">
    <h2>Recent Entries</h2>

    <% if (recent && recent.length) { %>
      <div class="table-scroll">
        <table class="grid">
          <thead>
            <tr>
              <th>Date</th>
              <th>Subject</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <% recent.forEach(function(r) { %>
              <tr>
                <td>
                  <%= r.date %>
                </td>
                <td>
                  <%= r.name %>
                </td>
                <td>
                  <%= r.status %>
                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>
      </div>
      <% } else { %>
        <p class="muted">No attendance entries yet.</p>
        <% } %>
  </section>



  <!-- ===================== INITIAL SEMESTER SETUP ===================== -->
  <section class="card">
    <h2>Initial Semester Setup</h2>
    <p class="muted">
      Use this if you are starting mid-semester.
      Enter total semester classes and attendance so far.
    </p>

    <% if (subjects && subjects.length) { %>
      <form method="post" action="/attendance/setup">

        <div class="table-scroll">
          <table class="grid">
            <thead>
              <tr>
                <th>Subject</th>
                <th>Total Semester Classes</th>
                <th>Classes Conducted So Far</th>
                <th>Classes Attended So Far</th>
              </tr>
            </thead>

            <tbody>
              <% subjects.forEach(function(s) { %>
                <tr>
                  <td>
                    <%= s.name %>
                  </td>

                  <td>
                    <input type="number" min="0" name="total_<%= s.id %>" value="<%= s.total_hours || 0 %>">
                  </td>

                  <td>
                    <input type="number" min="0" name="conducted_<%= s.id %>" value="<%= s.conducted_hours || 0 %>">
                  </td>

                  <td>
                    <input type="number" min="0" name="attended_<%= s.id %>" value="<%= s.attended_hours || 0 %>">
                  </td>

                </tr>
                <% }) %>
            </tbody>
          </table>
        </div>

        <button type="submit" class="btn">
          Save Semester Setup
        </button>
      </form>
      <% } else { %>
        <p class="muted">
          No subjects found. Set your timetable first.
        </p>
        <% } %>
  </section>



  <%- include('partials/footer') %>